<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Jay Ashe from Cava - Elixir in Production | SmartLogic</title>
  <meta name="description" content="We talk with Jay Ashe from Cava about their current and past Elixir projects and how they are deployed."/>
  <link rel="stylesheet" href="/css/normalize.css" />
  <link rel="stylesheet" href="/css/app.css" />
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K9MMX6TR');</script>
<!-- End Google Tag Manager -->



  <meta property="og:title" content="Jay Ashe from Cava - Elixir in Production" />
  <meta property="og:url" content="https://smartlogic.io/podcast/elixir-wizards/season-1-cava" />
  <meta property="og:type" content="website" />
  <meta property="og:description" content="We talk with Jay Ashe from Cava about their current and past Elixir projects and how they are deployed." />
  <meta property="og:audio:secure_url" content="https://aphid.fireside.fm/d/1437767933/03a50f66-dc5e-4da4-ab6e-31895b6d4c9e/c300841a-d5b9-4957-950f-ce0f6bc3af68.mp3" />
  <meta property="og:audio:type" content="audio/vnd.facebook.bridge" />
  <meta property="og:site_name" content="Elixir Wizards" />
  <meta property="og:image" content="https://assets.fireside.fm/file/fireside-images-2024/podcasts/images/0/03a50f66-dc5e-4da4-ab6e-31895b6d4c9e/episodes/c/c300841a-d5b9-4957-950f-ce0f6bc3af68/cover.jpg?v=2" />
  <meta property="og:imageWidth" content="1400" />
  <meta property="og:imageHeight" content="1400" />

  <meta name="twitter:card" content="player" />
  <meta name="twitter:player" content="https://fireside.fm/player/v2/IAs5ixts+gv-OH0jo/twitter" />
  <meta name="twitter:player:width" content="290" />
  <meta name="twitter:player:height" content="58" />
  <meta name="twitter:player:stream" content="https://aphid.fireside.fm/d/1437767933/03a50f66-dc5e-4da4-ab6e-31895b6d4c9e/c300841a-d5b9-4957-950f-ce0f6bc3af68.mp3" />
  <meta name="twitter:player:stream:content_type" content="audio/mpeg" />
  <meta name="twitter:site" content="@smartlogic">
  <meta name="twitter:url" content="https://smartlogic.io/podcast/elixir-wizards/season-1-cava">
  <meta name="twitter:title" content="Jay Ashe from Cava - Elixir in Production">
  <meta name="twitter:description" content="We talk with Jay Ashe from Cava about their current and past Elixir projects and how they are deployed.">
  <meta name="twitter:image" content="https://assets.fireside.fm/file/fireside-images-2024/podcasts/images/0/03a50f66-dc5e-4da4-ab6e-31895b6d4c9e/episodes/c/c300841a-d5b9-4957-950f-ce0f6bc3af68/cover.jpg?v=2">
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K9MMX6TR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <div class="wrapper">
    <header class="header">
  <div class="header__wrap">
    <div class="header__logo">
      <a href="/">
        <img src="/images/logo/smartlogic.svg" alt="SmartLogic Logo" />
      </a>
    </div>
    <div class="header__hamburger-wrap">
      <span></span><span></span><span></span><span></span><span></span><span></span>
    </div>
    <nav class="header__menu">
      <ul class="header__menu-list">
        <li class="header__menu-item"><a href="/software-development">Services</a></li>
        <li class="header__menu-item"><a href="/technologies">Technologies</a></li>
        <li class="header__menu-item"><a href="/method">Method</a></li>
        <li class="header__menu-item"><a href="/case-studies">Case Studies</a></li>
        <li class="header__menu-item"><a href="/podcast/elixir-wizards">Podcast</a></li>
        <li class="header__menu-item"><a href="/blog">Blog</a></li>
        <li class="header__menu-item"><a class="btn" href="/contact">Let's Get Started</a></li>
      </ul>
    </nav>
  </div>
</header>

    <div id="breadcrumbs">

<a href="/">Home</a>

  
    &gt; <a href="/podcast/">Podcast</a>
  

  
    &gt; <a href="/podcast/elixir-wizards/">Elixir wizards</a>
  

  
    > Jay Ashe from Cava - Elixir in Production
  

</div>


  <main class="main main-home" role="main">
    <section class="section hero hero__main">
      <div class="container">
        <div class="hero__left">
          <div class="hero__left-text">
            <div class="head-text">
              <h1>Jay Ashe from Cava - Elixir in Production</h1>
            </div>
          </div>
      </div>
    </section>

    <div class="content-page-wrapper">

      <section class="section content-block podcast">
        
<iframe style="margin-bottom:20px" src="https://fireside.fm/player/v2/IAs5ixts+gv-OH0jo" width="740" height="200" frameborder="0" scrolling="no"></iframe>


        <h2>About this Episode</h2>
        <h3>
          Published April  4, 2019 |
          Duration: 17:25 |
          <a href="https://feeds.fireside.fm/smartlogic/rss">RSS Feed</a> |
          <a href="https://aphid.fireside.fm/d/1437767933/03a50f66-dc5e-4da4-ab6e-31895b6d4c9e/c300841a-d5b9-4957-950f-ce0f6bc3af68.mp3">Direct download</a> <br/>
        
          Transcript:
          
          <a href="/podcast/elixir-wizards/transcripts/season-1-cava.txt">English</a>
          
        
      </h3>

        <!-- description copy starts here - pulled from fireside -->
        
        <p>We talk with Jay Ashe from Cava about their current and past Elixir projects and how they are deployed.</p>

<p>Jay Ashe - <a href="https://cava.com/" rel="nofollow">Cava</a></p>

<p>Find Jay elsewhere online:<br>
<a href="https://twitter.com/jgashe" rel="nofollow">https://twitter.com/jgashe</a></p>

<p>0:40 - Give us a quick overview of the Elixir projects you have in production.</p>

<p>CAVA is a fast-casual mediterranean restaurant chain with 75 stores across the US. Elixir and phoenix power CAVA’s online ordering platform (order.cava.com and the CAVA app). We’ve got a REST (and websockets) api sitting behind react and our mobile apps, and we use phoenix templates for some of our back of house systems.</p>

<p>1:11 - Why are you using Elixir in production?</p>

<p>We have from the start! The application was originally implemented by Chris Bell and his team at madebymany. Chris, by the way, has a fantastic talk from ElixirConf 2016 that goes into our architecture and how we use elixir and OTP constructs to model our business logic. Chris will occasionally talk about the CAVA project on his Elixir podcast, ElixirTalk.</p>

<p>Chris’ Talk - <a href="https://www.youtube.com/watch?v=fkDhU-2NWJ8" rel="nofollow">https://www.youtube.com/watch?v=fkDhU-2NWJ8</a></p>

<p>1:58 - What are some of the high level advantages / disadvantages of Elixir, from your perspective?</p>

<p>Advantages: Elixir and Phoenix gives you rails-esque productivity/developer experience that scales. I think phoenix channels are a great example of this. Build a channel with complex real-time functionality and let it scale effortlessly. </p>

<p>Disadvantages: </p>

<ul>
<li>Hiring and onboarding, depending on your mindset, can be difficult. If you’re used to hiring for experience in  your stack, its just going to be more difficult. Lately we’ve started doing one-hour weekly knowledge shares that cover elixir basics and are closely tied to our usage of them. So, here’s a test case, and here are all of the test helpers that we have set up that will help you write that test. We also just sent a new Elixir dev to lonestar elixir </li>
</ul>

<p>3:59 - What do you use to host your Elixir app?</p>

<ul>
<li><p>Heroku </p></li>
<li><p>How do you deploy your application? </p>

<ul>
<li>Heroku-buildpack-elixir <a href="https://github.com/HashNuke/heroku-buildpack-elixir" rel="nofollow">https://github.com/HashNuke/heroku-buildpack-elixir</a> </li>
</ul></li>
</ul>

<p>4:44 - Are you able to get zero downtime deploys?</p>

<ul>
<li>As close as possible! We get that out of the box with heroku. When we deploy, heroku won’t point traffic to the new dyno until the app is healthy. We make extensive use of Phoenix channels over websockets, and our clients will reconnect automatically and transparently.<br></li>
</ul>

<p>5:10 - Do you cluster the application?</p>

<ul>
<li>Nope.<br></li>
</ul>

<p>5:52 - How does your Elixir App perform compared to others in your environment?</p>

<ul>
<li>I can’t really talk about numbers here, but Elixir is not at all our bottleneck. We don’t have other production applications </li>
</ul>

<p>6:25 - How are you solving background task processing?</p>

<ul>
<li>Quantum for cron jobs, genservers for everything else. We’re running a single elixir application that handles all synchronous and async processing<br></li>
</ul>

<p>7:07 - What libraries are you using?</p>

<ul>
<li>Phoenix </li>
<li>Phoenix_swagger for API documentation that integrates with controller tests <a href="https://github.com/xerions/phoenix_swagger" rel="nofollow">https://github.com/xerions/phoenix_swagger</a> </li>
<li>Ex_rated for rate limiting calls to our integrations <a href="https://github.com/grempe/ex_rated" rel="nofollow">https://github.com/grempe/ex_rated</a> </li>
<li>Timex and calendar for datetime support with timezones <a href="https://github.com/bitwalker/timex" rel="nofollow">https://github.com/bitwalker/timex</a> </li>
<li>A combination of httpotion and httpoison for HTTP clients, but im interested in trying Mint <a href="https://github.com/ericmj/mint" rel="nofollow">https://github.com/ericmj/mint</a><a href="https://github.com/appcues/mojito" rel="nofollow">https://github.com/appcues/mojito</a> </li>
<li>Bamboo for transactional emails, like order confirmations etc <a href="https://github.com/thoughtbot/bamboo" rel="nofollow">https://github.com/thoughtbot/bamboo</a> </li>
</ul>

<p>8:59 - 3rd Party Services (i.e. Email, Payment Processing, etc)</p>

<ul>
<li>Sendgrid for email, Google for geocoding, slack for some internal alerting of application health, LevelUp for payments. <a href="https://www.thelevelup.com/" rel="nofollow">https://www.thelevelup.com/</a> </li>
</ul>

<p>10:07 - Do you have a story where Elixir saved the day in production?</p>

<ul>
<li>Yes and no. So I could tell this story by explaining the issue we saw and the underlying cause at the same time, but I think it would be more fun to tell it like our team experienced it. </li>
<li>One day at lunch our application started going down. Lots of 500 errors. Red lights flashing. Panic ensuing. Lunch is our busiest time of day, so 1) we thought it was load related and 2) we really needed to fix it </li>
<li>None of our traditional resources (database, cpu, memory) were constrained and our integrations that were synchronous were fine.<br></li>
<li>Our logs were littered with errors from an analytics integration that ran asynchronously on genservers, but it didn’t seem related because we could see the error logs at times when our application was otherwise healthy. The team that used the analytics didn’t have a pressing need for them, and we deprioritized fixing the issue because the bug we were working on was so much more important (that’s foreshadowing). </li>
<li>I spent a little time looking at websockets, but I was easily able to match the load of the websocket portion of our application on my local machine with no degradations in performance (thanks, phoenix), so that was out. </li>
<li>At this point the issue was going on every day at lunch and I was getting annoyed at seeing the logs from the analytics integration when debugging, so I spent like 15 minutes finding and fixing the issue (a bad API key, basically) </li>
<li>Voila, issue gone. Time to grab some lunch. </li>
<li>We spent a while coming up with an explanation for this. Eventually we learned about max_restarts on a supervisor. By default, if a process crashes 3 times in 5 seconds, the process won’t be restarted again. So if another process (like the one handling a web request) tries to call that process that wasn’t restarted, the caller would crash, and we’d start to get 500 errors, customers couldn’t log in, mass confusion. </li>
<li>So there are a few takeaways from this story: For a while, elixir saved the day in production.<br>
    - A supervision tree prevented failures from the analytics process from affecting customers, until the scale of our failures exceeded the max_restart level.<br>
    - Our supervision tree needed some love though, clearly. 
    - Monitor your resources. CPU is a resource, but calls to another API are also a resource and can get unhealthy too.<br></li>
</ul>

<p>15:00 - Are you using any cool OTP features?</p>

<ul>
<li>GenServers, definitely. There’s lots we can do asynchronously especially in terms of our integrations. One process per store is a cool model that scales well and keeps issues isolated to a single store. </li>
</ul>

<p>15:50 - If you could give one tip to developers out there who are or may soon be running Elixir in production, what would it be?</p>

<ul>
<li>If you’re on a small team, Heroku or a similar provider might give you a lot of value in terms of infrastructure you can set up and forget.</li>
</ul>

<p>Learn more about how SmartLogic uses <a href="https://smr.tl/2Hyslu8" rel="nofollow">Phoenix and Elixir.</a></p><p>Special Guest: Jay Ashe.</p><p>Links:</p><ul><li><a href="https://www.youtube.com/watch?v=fkDhU-2NWJ8" title="ElixirConf 2016 - Selling Food With Elixir by Chris Bell" rel="nofollow">ElixirConf 2016 - Selling Food With Elixir by Chris Bell</a></li><li><a href="https://github.com/HashNuke/heroku-buildpack-elixir" title="Heroku-buildpack-elixir" rel="nofollow">Heroku-buildpack-elixir</a></li><li><a href="https://github.com/xerions/phoenix_swagger" title="Phoenix Swagger" rel="nofollow">Phoenix Swagger</a></li><li><a href="https://github.com/grempe/ex_rated" title="Ex_rated" rel="nofollow">Ex_rated</a></li><li><a href="https://github.com/bitwalker/timex" title="Timex" rel="nofollow">Timex</a></li><li><a href="https://github.com/ericmj/mint" title="Mint" rel="nofollow">Mint</a></li><li><a href="https://github.com/appcues/mojito" title="Mojito" rel="nofollow">Mojito</a></li><li><a href="https://www.thelevelup.com/" title="LevelUp" rel="nofollow">LevelUp</a></li></ul>
      
        <!-- end copy from fireside -->

        
          <h2>Transcript (English):</h2>
          <object width="100%" height="700" type="text/txt" data="/podcast/elixir-wizards/transcripts/season-1-cava.txt" border="1" >
          </object>
        

      </section>

  </main>
  <footer class="footer">
    <div class="footer__wrap">
  <div class="container">
    <div class="footer__wrap-col">
      <div class="footer__left">
        <div class="footer__left-logo"><a href="/"><img src="/images/logo/smartlogic.svg" alt="Smartlogic Logo" /></a></div>
        <div class="footer__left-text">
          <p>8 Market Pl Ste 377</p>
          <p>Baltimore, MD 21202</p>
          <p>888-544-SMRT</p>
        </div>
      </div>
      <div class="footer__right">
        <div class="footer__right-socials">
          <ul class="footer__right-socials-list">
            <li class="footer__right-socials-item">
              <a href="https://twitter.com/smartlogic">
                <img src="/images/icons/social-icons/tw.svg" alt="Twiter Icon" />
              </a>
            </li>
            <li class="footer__right-socials-item">
              <a href="https://www.facebook.com/smartlogic">
                <img src="/images/icons/social-icons/fb.svg" alt="Facebook Icon" />
              </a>
            </li>
            <li class="footer__right-socials-item">
              <a href="https://www.linkedin.com/company/smartlogic-io">
                <img src="/images/icons/social-icons/in.svg" alt="Linkedin Icon" />
              </a>
            </li>
            <li class="footer__right-socials-item">
              <a href="https://github.com/smartlogic">
                <img src="/images/icons/social-icons/gh.svg" alt="Github Icon" />
              </a>
            </li>
            <li class="footer__right-socials-item">
              <a href="https://www.youtube.com/channel/UCWAV0_JasFSJMLGryeUedCQ">
                <img src="/images/icons/social-icons/yt.svg" alt="YouTube Icon" />
              </a>
            </li>
            <li class="footer__right-socials-item">
              <a href="https://www.twitch.tv/smartlogictv">
                <img src="/images/icons/social-icons/twitch.svg" alt="Twitch Icon" />
              </a>
            </li>
          </ul>
        </div>
        <div class="footer__right-menu">
          <ul class="footer__right-menu-list">
            <li class="footer__right-menu-item"><a href="/about">About Us</a></li>
            <li class="footer__right-menu-item"><a href="/about/team">Our Team</a></li>
            <li class="footer__right-menu-item"><a href="/about/community">Community</a></li>
            <li class="footer__right-menu-item"><a href="https://blog.smartlogic.io/">Blog</a></li>
            <!-- <li class="footer__right-menu-item"><a target="_blank" href="https://mailchi.mp/smartlogic/signup">Newsletter</a></li> -->
            <li class="footer__right-menu-item"><a href="/about/privacy.html">Privacy Policy</a></li>
            <li class="footer__right-menu-item"><a href="/about/jobs">Jobs</a></li>

          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  </footer>

  </div>
  <script src="/javascript/main.js"></script>
</body>
</html>
